<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©å¹²åœ°æ”¯äº”è¡Œå±æ€§ç»Ÿè®¡</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background-color: #f8f4e9; 
            min-height: 100vh; 
            font-family: "SimHei", "Microsoft YaHei", sans-serif; 
            color: #4a3520; 
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 15px; }
        header {
            background-color: #4a3520;
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        header h1 { font-size: 28px; margin-bottom: 10px; }
        header p { color: #e8d9b5; font-size: 16px; }
        main { padding: 30px 0; }
        .grid-layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        @media (min-width: 992px) {
            .grid-layout { grid-template-columns: 1fr 2fr; }
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(107, 72, 38, 0.2);
            margin-bottom: 20px;
        }
        .card h2 {
            font-size: 22px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e8d9b5;
        }
        .card h3 { font-size: 18px; margin-bottom: 15px; color: #6b4826; }
        .select-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 25px;
        }
        .select-option {
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid #ccc;
        }
        .select-option:hover { background-color: #e8d9b5; }
        .select-option.active-option {
            background-color: #d4b589;
            font-weight: bold;
            color: #4a3520;
        }
        .select-option span.text-xs { font-size: 12px; color: #666; margin-left: 5px; }
        .btn-group { display: flex; gap: 10px; }
        .btn {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            font-family: inherit;
        }
        .btn-reset {
            background-color: #6b4826;
            color: white;
        }
        .btn-reset:hover { background-color: #4a3520; }
        .btn-calc {
            background-color: #2ecc71;
            color: white;
        }
        .btn-calc:hover { background-color: #27ae60; }
        .elements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .element-card {
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(107, 72, 38, 0.2);
            transition: all 0.3s;
            border-left: 4px solid #ccc;
        }
        .element-card:hover { transform: scale(1.05); }
        .element-card h3 { margin-bottom: 8px; font-size: 16px; }
        .element-card .count { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
        .element-card .items { font-size: 12px; color: #666; }
        .wood { border-left-color: #2ecc71; background-color: rgba(46, 204, 113, 0.1); }
        .wood h3, .wood .count { color: #2ecc71; }
        .fire { border-left-color: #e74c3c; background-color: rgba(231, 76, 60, 0.1); }
        .fire h3, .fire .count { color: #e74c3c; }
        .earth { border-left-color: #f39c12; background-color: rgba(243, 156, 18, 0.1); }
        .earth h3, .earth .count { color: #f39c12; }
        .metal { border-left-color: #3498db; background-color: rgba(52, 152, 219, 0.1); }
        .metal h3, .metal .count { color: #3498db; }
        .water { border-left-color: #9b59b6; background-color: rgba(155, 89, 182, 0.1); }
        .water h3, .water .count { color: #9b59b6; }
        /* å…³é”®ä¿®å¤ï¼šå¼ºåˆ¶Canvaså®¹å™¨å°ºå¯¸ï¼Œé¿å…æ¸²æŸ“å¼‚å¸¸ */
        .chart-wrapper {
            width: 100%;
            height: 350px;
            margin: 0 auto;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
        }
        #elementChart {
            width: 100% !important;
            height: 100% !important;
        }
        .selected-item {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            margin: 0 4px 4px 0;
            font-size: 14px;
        }
        footer {
            background-color: #4a3520;
            color: #e8d9b5;
            padding: 20px 0;
            text-align: center;
            margin-top: 30px;
        }
        footer p { margin-bottom: 5px; font-size: 14px; }
    </style>
    <!-- 1. ä¼˜å…ˆåŠ è½½Chart.jsï¼Œç¡®ä¿å…¨å±€å¯ç”¨ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1>å¤©å¹²åœ°æ”¯äº”è¡Œå±æ€§ç»Ÿè®¡</h1>
            <p>é€‰æ‹©å¤©å¹²ã€åœ°æ”¯ï¼Œå®æ—¶ç»Ÿè®¡é‡‘æœ¨æ°´ç«åœŸå±æ€§åˆ†å¸ƒ</p>
        </div>
    </header>

    <main class="container">
        <div class="grid-layout">
            <div class="card">
                <h2>å±æ€§é€‰æ‹©</h2>
                <div>
                    <h3>å¤©å¹²</h3>
                    <div class="select-options" id="tianGanList"></div>
                </div>
                <div>
                    <h3>åœ°æ”¯</h3>
                    <div class="select-options" id="diZhiList"></div>
                </div>
                <div class="btn-group">
                    <button id="resetBtn" class="btn btn-reset">ğŸ”„ é‡ç½®é€‰æ‹©</button>
                    <button id="calcBtn" class="btn btn-calc">ğŸ§® ç»Ÿè®¡å±æ€§</button>
                </div>
            </div>

            <div>
                <div class="card">
                    <h2>äº”è¡Œå±æ€§åˆ†å¸ƒ</h2>
                    <div class="elements-grid">
                        <div class="element-card wood">
                            <h3>æœ¨</h3>
                            <div class="count" id="woodCount">0</div>
                            <div class="items" id="woodItems">-</div>
                        </div>
                        <div class="element-card fire">
                            <h3>ç«</h3>
                            <div class="count" id="fireCount">0</div>
                            <div class="items" id="fireItems">-</div>
                        </div>
                        <div class="element-card earth">
                            <h3>åœŸ</h3>
                            <div class="count" id="earthCount">0</div>
                            <div class="items" id="earthItems">-</div>
                        </div>
                        <div class="element-card metal">
                            <h3>é‡‘</h3>
                            <div class="count" id="metalCount">0</div>
                            <div class="items" id="metalItems">-</div>
                        </div>
                        <div class="element-card water">
                            <h3>æ°´</h3>
                            <div class="count" id="waterCount">0</div>
                            <div class="items" id="waterItems">-</div>
                        </div>
                    </div>
                    <!-- 2. ä¿®å¤Chartå®¹å™¨ï¼šæ–°å¢å¤–å±‚wrapperå¼ºåˆ¶å°ºå¯¸ -->
                    <div class="chart-wrapper">
                        <canvas id="elementChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h2>å·²é€‰å±æ€§åˆ—è¡¨</h2>
                    <div id="selectedList">
                        <p style="color: #999; font-style: italic;">è¯·é€‰æ‹©å¤©å¹²/åœ°æ”¯åç‚¹å‡»ç»Ÿè®¡æŒ‰é’®</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>å¤©å¹²åœ°æ”¯äº”è¡Œå±æ€§ç»Ÿè®¡å·¥å…· Â© 2025</p>
            <p style="font-size: 12px;">äº”è¡Œå¯¹åº”ï¼šæœ¨(ç»¿)ã€ç«(çº¢)ã€åœŸ(é»„)ã€é‡‘(è“)ã€æ°´(ç´«)</p>
        </div>
    </footer>

    <script>
        // å…¨å±€å˜é‡æå‰å£°æ˜ï¼Œé¿å…ä½œç”¨åŸŸé—®é¢˜
        let selectedItems = [];
        let chartInstance = null; // é‡å‘½åé¿å…å’ŒChartç±»å†²çª
        const wuxingData = {
            tianGan: [
                { name: 'ç”²', element: 'wood', color: '#2ecc71' },
                { name: 'ä¹™', element: 'wood', color: '#2ecc71' },
                { name: 'ä¸™', element: 'fire', color: '#e74c3c' },
                { name: 'ä¸', element: 'fire', color: '#e74c3c' },
                { name: 'æˆŠ', element: 'earth', color: '#f39c12' },
                { name: 'å·±', element: 'earth', color: '#f39c12' },
                { name: 'åºš', element: 'metal', color: '#3498db' },
                { name: 'è¾›', element: 'metal', color: '#3498db' },
                { name: 'å£¬', element: 'water', color: '#9b59b6' },
                { name: 'ç™¸', element: 'water', color: '#9b59b6' }
            ],
            diZhi: [
                { name: 'å­', element: 'water', color: '#9b59b6' },
                { name: 'ä¸‘', element: 'earth', color: '#f39c12' },
                { name: 'å¯…', element: 'wood', color: '#2ecc71' },
                { name: 'å¯', element: 'wood', color: '#2ecc71' },
                { name: 'è¾°', element: 'earth', color: '#f39c12' },
                { name: 'å·³', element: 'fire', color: '#e74c3c' },
                { name: 'åˆ', element: 'fire', color: '#e74c3c' },
                { name: 'æœª', element: 'earth', color: '#f39c12' },
                { name: 'ç”³', element: 'metal', color: '#3498db' },
                { name: 'é…‰', element: 'metal', color: '#3498db' },
                { name: 'æˆŒ', element: 'earth', color: '#f39c12' },
                { name: 'äº¥', element: 'water', color: '#9b59b6' }
            ]
        };

        // 3. é¡µé¢å®Œå…¨åŠ è½½åå†åˆå§‹åŒ–ï¼ˆç¡®ä¿Chart.jså·²åŠ è½½å®Œæˆï¼‰
        window.onload = function() {
            // éªŒè¯Chart.jsæ˜¯å¦åŠ è½½æˆåŠŸ
            if (typeof Chart === 'undefined') {
                alert('Chart.jsåŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–æ›´æ¢æµè§ˆå™¨ï¼');
                return;
            }

            // ç”Ÿæˆé€‰é¡¹
            renderOptions('tianGanList', wuxingData.tianGan);
            renderOptions('diZhiList', wuxingData.diZhi);
            
            // åˆå§‹åŒ–å›¾è¡¨ï¼ˆå¼ºåˆ¶åˆ›å»ºï¼Œé¿å…ä¸Šä¸‹æ–‡ä¸¢å¤±ï¼‰
            initChart();

            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('calcBtn').onclick = calculate;
            document.getElementById('resetBtn').onclick = resetAll;
        };

        // æ¸²æŸ“é€‰é¡¹
        function renderOptions(containerId, data) {
            const container = document.getElementById(containerId);
            data.forEach(item => {
                const option = document.createElement('div');
                option.className = 'select-option';
                option.dataset.name = item.name;
                option.dataset.element = item.element;
                option.style.borderLeft = `3px solid ${item.color}`;
                option.innerHTML = `
                    <span>${item.name}</span>
                    <span class="text-xs">${{ wood: 'æœ¨', fire: 'ç«', earth: 'åœŸ', metal: 'é‡‘', water: 'æ°´' }[item.element]}</span>
                `;
                option.onclick = function() {
                    this.classList.toggle('active-option');
                    const type = containerId === 'tianGanList' ? 'å¤©å¹²' : 'åœ°æ”¯';
                    if (this.classList.contains('active-option')) {
                        selectedItems.push({ name: item.name, element: item.element, type });
                    } else {
                        selectedItems = selectedItems.filter(i => i.name === item.name && i.type === type);
                    }
                };
                container.appendChild(option);
            });
        }

        // 4. é‡æ„å›¾è¡¨åˆå§‹åŒ–ï¼šå¼ºåˆ¶æŒ‡å®šå°ºå¯¸ï¼Œå…¼å®¹æ‰€æœ‰æµè§ˆå™¨
        function initChart() {
            const ctx = document.getElementById('elementChart');
            // å¼ºåˆ¶è®¾ç½®Canvaså°ºå¯¸ï¼ˆè§£å†³ç§»åŠ¨ç«¯/ä½ç‰ˆæœ¬æµè§ˆå™¨æ¸²æŸ“bugï¼‰
            ctx.width = ctx.offsetWidth;
            ctx.height = ctx.offsetHeight;

            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['æœ¨', 'ç«', 'åœŸ', 'é‡‘', 'æ°´'],
                    datasets: [{
                        label: 'äº”è¡Œæ•°é‡',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: ['#2ecc71', '#e74c3c', '#f39c12', '#3498db', '#9b59b6'],
                        borderWidth: 2,
                        borderColor: '#ffffff',
                        hoverBorderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // å…³é”®ï¼šç¦ç”¨å®½é«˜æ¯”ï¼Œè·Ÿéšå®¹å™¨
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: { size: 14, family: 'SimHei, Microsoft YaHei' },
                                color: '#4a3520',
                                padding: 15
                            }
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(74, 53, 32, 0.9)',
                            titleFont: { size: 14 },
                            bodyFont: { size: 12 },
                            padding: 10,
                            cornerRadius: 6,
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw} ä¸ª`;
                                }
                            }
                        }
                    },
                    cutout: '60%',
                    animation: {
                        duration: 800,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        // ç»Ÿè®¡é€»è¾‘
        function calculate() {
            if (selectedItems.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è‡³å°‘ä¸€ä¸ªå¤©å¹²/åœ°æ”¯ï¼');
                return;
            }

            // ç»Ÿè®¡äº”è¡Œæ•°æ®
            const result = { wood: 0, fire: 0, earth: 0, metal: 0, water: 0 };
            const itemsMap = { wood: [], fire: [], earth: [], metal: [], water: [] };
            selectedItems.forEach(item => {
                result[item.element]++;
                itemsMap[item.element].push(`${item.type}${item.name}`);
            });

            // æ›´æ–°æ•°å€¼æ˜¾ç¤º
            document.getElementById('woodCount').textContent = result.wood;
            document.getElementById('fireCount').textContent = result.fire;
            document.getElementById('earthCount').textContent = result.earth;
            document.getElementById('metalCount').textContent = result.metal;
            document.getElementById('waterCount').textContent = result.water;

            document.getElementById('woodItems').textContent = itemsMap.wood.join('ã€') || '-';
            document.getElementById('fireItems').textContent = itemsMap.fire.join('ã€') || '-';
            document.getElementById('earthItems').textContent = itemsMap.earth.join('ã€') || '-';
            document.getElementById('metalItems').textContent = itemsMap.metal.join('ã€') || '-';
            document.getElementById('waterItems').textContent = itemsMap.water.join('ã€') || '-';

            // 5. å¼ºåˆ¶æ›´æ–°å›¾è¡¨ï¼ˆè§£å†³æ•°æ®ä¸åˆ·æ–°é—®é¢˜ï¼‰
            chartInstance.data.datasets[0].data = [result.wood, result.fire, result.earth, result.metal, result.water];
            chartInstance.update('none'); // æ— åŠ¨ç”»å¼ºåˆ¶æ›´æ–°ï¼Œç¡®ä¿ç«‹å³æ¸²æŸ“

            // æ›´æ–°å·²é€‰åˆ—è¡¨
            updateSelectedList();
        }

        // é‡ç½®é€»è¾‘
        function resetAll() {
            document.querySelectorAll('.select-option').forEach(option => option.classList.remove('active-option'));
            selectedItems = [];
            
            // é‡ç½®æ•°å€¼
            document.getElementById('woodCount').textContent = '0';
            document.getElementById('fireCount').textContent = '0';
            document.getElementById('earthCount').textContent = '0';
            document.getElementById('metalCount').textContent = '0';
            document.getElementById('waterCount').textContent = '0';
            
            document.getElementById('woodItems').textContent = '-';
            document.getElementById('fireItems').textContent = '-';
            document.getElementById('earthItems').textContent = '-';
            document.getElementById('metalItems').textContent = '-';
            document.getElementById('waterItems').textContent = '-';

            // é‡ç½®å›¾è¡¨
            chartInstance.data.datasets[0].data = [0, 0, 0, 0, 0];
            chartInstance.update('none');

            // é‡ç½®åˆ—è¡¨
            document.getElementById('selectedList').innerHTML = '<p style="color: #999; font-style: italic;">è¯·é€‰æ‹©å¤©å¹²/åœ°æ”¯åç‚¹å‡»ç»Ÿè®¡æŒ‰é’®</p>';
        }

        // æ›´æ–°å·²é€‰åˆ—è¡¨
        function updateSelectedList() {
            const list = document.getElementById('selectedList');
            const tianGan = selectedItems.filter(i => i.type === 'å¤©å¹²');
            const diZhi = selectedItems.filter(i => i.type === 'åœ°æ”¯');
            
            const getTag = (item) => {
                const bg = { wood: '#2ecc711a', fire: '#e74c3c1a', earth: '#f39c121a', metal: '#3498db1a', water: '#9b59b61a' }[item.element];
                const color = { wood: '#2ecc71', fire: '#e74c3c', earth: '#f39c12', metal: '#3498db', water: '#9b59b6' }[item.element];
                return `<span class="selected-item" style="background:${bg};color:${color};">${item.name}</span>`;
            };

            list.innerHTML = `
                <div style="margin-bottom:10px;">
                    <strong>å¤©å¹²ï¼š</strong>${tianGan.map(getTag).join(' ') || 'æ— '}
                </div>
                <div>
                    <strong>åœ°æ”¯ï¼š</strong>${diZhi.map(getTag).join(' ') || 'æ— '}
                </div>
            `;
        }
    </script>
</body>
</html>